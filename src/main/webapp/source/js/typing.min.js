var transtime=document.getElementById("useTime").value;var start=-1;var SourceString=document.getElementById("oldcontent").value;var sp=SourceString.length;var curentWord=0;var accuracy=document.getElementById("_accuracy").value;var sorce=document.getElementById("score").value;var len=$("#ss").width();var linenum=(sp*20)/len;var linconnum=parseInt(len/20)-1;var errorcount=0;var oldContent=document.getElementById("oldContent").value;function begin(){start*=-1;if(start==1){tt=setInterval("showtime()",1000);if((sp*20)%len!=0){linenum=parseInt(linenum)+1}else{linenum=parseInt(linenum)}var oldlinenum=(oldContent.length*20)/len;if((oldContent.length*20)*len!=0){oldlinenum=parseInt(oldlinenum)+1}else{oldlinenum=parseInt(oldlinenum)}var cont=document.getElementById("ss");while(cont.hasChildNodes()){cont.removeChild(cont.firstChild)}for(var i=0;i<linenum;i++){var div60=document.createElement("div");div60.style.height="60px";var div30=document.createElement("div");div30.id="d"+i;div30.style.height="30px";div30.style.fontSize="20px";div30.style.marginTop="10px";div30.innerText=SourceString.substring(i*linconnum,i*linconnum+linconnum);div60.appendChild(div30);var input=document.createElement("input");input.id="in"+i;input.type="text";input.disabled=false;input.maxlength = linconnum;input.onkeyup=function(){Test(this)};input.style.fontSize="20px";input.style.width="100%";input.value=oldContent.substring(i*linconnum,i*linconnum+linconnum);div60.appendChild(input);cont.appendChild(div60)}}else{oldContent="";for(var i=0;i<linenum;i++){oldContent+=document.getElementById("in"+i).value}for(var i=0;i<linenum;i++){document.getElementById("in"+i).disabled=true}linenum--;window.clearInterval(tt)}ajaxJson()}function showtime(){transtime++;document.getElementById("ttime").innerText=transtime+" 秒";if(transtime>10000){alert("时间到，考试结束！");document.getElementById("form").submit()}}var errorlineCount=new Array();function Test(obj){oldContent="";for(var i=0;i<linenum;i++){oldContent+=document.getElementById("in"+i).value}var str=obj.value;var TargetObj="";var flag=(obj.id).substring(2);var temp="";var tempcount=0;var dvlue=$("#d"+flag).text();for(var i=0;i<dvlue.length;i++){if(i<str.length){if(str.substring(i,i+1)==dvlue.substring(i,i+1)){temp=temp+"<span class='right1'>"+dvlue.substring(i,i+1)+"</span>"}else{temp=temp+"<span class='error1'>"+dvlue.substring(i,i+1)+"</span>";tempcount++}curentWord=i+1}else{temp=temp+dvlue.substring(i,i+1)}}errorlineCount[flag]=tempcount;errorcount=0;for(var i=0;i<errorlineCount.length;i++){errorcount+=errorlineCount[i]}document.getElementById("d"+flag).innerHTML=temp;document.getElementById("error").innerText=errorcount+" 个";accuracy=document.getElementById("accuracy").innerText=(sp-errorcount)/sp;sorce=(100/sp)*(oldContent.length-errorcount);document.getElementById("_score_").innerText=sorce}function submit(){document.getElementById("typetext").value=oldContent;document.getElementById("time").value=transtime;document.getElementById("er").value=errorcount;document.getElementById("_score").value=sorce;document.getElementById("_accuracy_").value=accuracy;document.getElementById("form").submit()}var xmlHttp;function create(){if(window.XMLHttpRequest){xmlHttp=new XMLHttpRequest()}else{if(window.ActiveXObject){try{xmlHttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{}catch(e){xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}}}}}function callback(){if(xmlHttp.readyState==4){if(xmlHttp.status==200){}else{}}}function run(){create();var url="http://"+document.location.hostname+":8080/ctyping/ajaxput";url=url+"?id="+document.getElementById("oid").value;url=url+"&accuracy="+accuracy;url=url+"&content="+oldContent;url=url+"&exam.id="+document.getElementById("examid").value;url=url+"&score="+sorce;url=url+"&user.id="+document.getElementById("userid").value;url=url+"&useTime="+transtime;url=url+"&math="+Math.random();xmlHttp.open("POST",url,true);xmlHttp.onreadystatechange=callback;xmlHttp.send(null);setTimeout("run()",5000)}function ajaxJson(){run()}$(document).ready(function(){$(document).bind("contextmenu",function(e){return false})});$(document).keydown(function(event){if(event.ctrlKey==true&&(event.which=="118"||event.which=="86")){event.preventDefault()}});